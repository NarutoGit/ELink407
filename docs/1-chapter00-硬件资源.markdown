# ELink407 硬件平台#

本章节主要介绍Elink407开发板的硬件资源，使大家对该开发板的功能及特点有个详细的了解。本章将分为如下几个部分：

1，开发板简介； 

2，开发板硬件详解；  

3，开发板使用注意事项； 



## 开发板简介 ##

### STM32407VG片上资源(芯片功能) ###

STM32407VGARM 是基于Cortex™-M4内核，可在高至168MHz的频率下运行，带有FPU单元。

*  ◆ 具有在系统编程（ISP）和在应用编程（IAP）功能的1M片上Flash程序存储器；

*  ◆ 时钟、复位和供电管理,2.0至3.6伏供电和I/O管脚，上电/断电复位(POR / PDR)、可编程电压监测器(PVD)，内嵌4至16MHz高速晶体振荡器，内嵌经出厂调校的8MHz RC振荡器，内部40kHz的RC振荡器，PLL供应CPU时钟，带校准的32kHzRTC振荡器；

*  ◆ 低功耗睡眠、停机和待机模式，VBAT为RTC和后备寄存器供电;

*  ◆ 调试模式串行线调试(SWD)和JTAG调试接口；

*  ◆ 液晶并行接口，8080 / 6800模式；

+  ◆ 3×12位，2.4 MSPS A/D转换器，24个转换通道；

*  ◆ 2×12位D/A转换器；

*  ◆ 通用DMA：16通道DMA控制器与FIFO和突发的支持；

*  ◆ 17个定时器；有12个16位和2个32位定时器的即数频率达168兆赫，每组包含4个输入捕获/输出比较/PWM或脉冲计数器通道；

*  ◆ 具有15个通信接口：

    - 2个I2C接口（SMBus/PMBus）；

    - 4个USARTs/2个UARTs(10兆位/秒)接口，支持ISO7816,LIN,IrDA接口和调制解调控制；

    - 3个SPI（37.5兆位/秒）和2个混合全双工I2S通过内部音频锁相环或外部时钟实现音频级的精度，复位和时钟的供给管理；

    - 2个CAN（2.0B主动）、1个SDIO接口；

*  ◆ 高级连接

    - USB 2.0全速器件/主机/OTG;

    - USB的2.0 high-speed/full-speed设备/主机/OTG控制器的专用DMA，片上全速PHY和ULPI;

    - 10/100以太网MAC专用DMA：支持IEEE1588v2的硬件，MII/ RMII;

*  ◆ 8-14位并行摄像机接口（54 Mbytes / s）

*  ◆ 唯一的96位ID


### 板载资源 ###

Elink407提供如下个特点：

*  ◆ STM32F407VGT6 微控制器有 1M 的 FLASH 存储器，192K 的 RAM，LQFP100 封装

*  ◆ 板上的 ST-LINK/V2 可以使用选择的方式把开发板切换成一个独立的 ST-LINK/V2 来使用（用 SWD 连接器来编程和调试）

*  ◆ 板子电源：通过 USB 总线或者外部 5V 电源来供电

*  ◆ 对外部应用供电：3V 和 5V

*  ◆ EMW1062无线wifi模块, 结合TCP/IP库接入网络，瞬间开发出物联网应用

*  ◆ 3.2TF-LCD,触摸屏

*  ◆ DHT11数字温湿度传感器

*  ◆ SPI,EEPROM存储芯片

*  ◆ micro SD卡座

*  ◆ USB转232，通过usb线与PC通信

*  ◆ 扩展接口

    - arduino接口兼容arduino外设

    - CAMERA接口

    - CAN接口

    - 485接口

    - 以太网接口

    - IIS音频接口

    - 独有的血压计接口

    - 其他功能接口

*  ◆ 5 个 LED 指示灯

    - LED1,LED2(红/绿)STlink下载调试通讯

    - LD3（红）用于 5V 上电

    - 2 个用户 LED(绿) 灯，LED4,LED5

*  ◆ 5 个按钮，休眠按键,复位健和3个用户按键

*  ◆ USB OTG，micro-AB 连接器

*  ◆ LQFP100 IO 口的扩展头，可以快速连接成原型板，易于探测


![](img/elink407/1.1.1.jpg) 

## 开发板硬件详解 ##

### MCU ###
"最小系统（包括复位，boot，电源,晶振)"
Elink407 开发板使用的是100脚LQFP封装的STM32F407VGT6芯片，我们将所有该芯片所以引脚引出，并提供丰富的外围扩展接口，充分满足广大爱好者的学习开发需求。Elink407 MCU部分原理图如下图所示：

![](img/chapter0/mcu_sch.png) 













虽然STM32F407VGT6内部已经包含了16MHz高速内部RC振荡电路和32kHz左右低速内部RC振荡电路LSE，但是其精准度不是很高，为此我们在外部增加了8MHz的晶振电路，为系统的可靠工作提供时序基准, 和可以用于驱动独立看门狗和通过程序选择驱动RTC实时时钟。VDDA与VREF是STM32处理器数字/模拟转换（ADC）电路需要使用到的模拟参考电源和模拟电源输入。 为保证其稳定性需要隔离并增加独立的滤波储能电容。 


### 启动模式 ###
    
![](img/chapter0/boot_sch.png) 
上图中的BOOT0, BOOT1用于设置STM32的启动方式，其对应启动模式如下表所示： 

       | BOOT1  BOOT0|启动模式    |说明                                    |   
       |    X   0    |主闪存存储器 | 内部FLASH被选为启动区域，一般使用此模式。  |
       |    0   1    |系统存储器  |运行出厂自举固件升级程序，用于串口下载固件    |
       |    1   1    |内置SRAM   |内置SRAM被选为启动区域，用于在SRAM中调试代码。|

● 从主闪存存储器启动：主闪存存储器被映射到启动空间(0x0000 0000)，但仍然能够在它原有的地址(0x0800 0000)访问它，即闪存存储器的内容可以在两个地址区域访问，0x0000 0000或0x0800 0000。

● 从系统存储器启动：系统存储器被映射到启动空间(0x0000 0000)，但仍然能够在它原有的地址访问它，神舟王STM32F407VGT原有地址为0x1FFF0000 - x1FFF77FF。

● 从内置SRAM启动：只能在0x2000 0000开始的地址区访问SRAM。

● 通过软件修改寄存器可以将FSMC的地址段映射到启动空间(0x0000 0000)。

如果内部Flash已经烧录了程序，一般正常运行时选择从主闪存存储器启动。如果要升级固件可以有多种方式，常见的有通过工具烧录和外设接口烧录两种方式。常用的烧录调试仿真工具如JLINK、STLink、Ulink等。

### 复位电路 ###

Elink407开发板使用RC加按键来实现手动复位和上电复位。STM32芯片内部已经集成有上电复位和电压检测复位电路，所以外部的复位主要是实现手动复位功能，其原理图如下。

![](img/chapter0/reset_sch.png) 

### 电源管理 ###

Elink407开发板支持的供电方式主要有三种，分别是：  

    ●  USB接口供电，最大500mA   
    ●  外部直流DC5V供电  
    ●  ST_LINK 5V供电 

![](img/chapter0/dc_sch.png) 

如上图所示，当J20接入5V电源适配器，开发板上就有了5V的电源，再通过DC-DC芯片，转换3.3V电源供MCU芯片和其他芯片或模块使用。大家也可以在下面的ST-LINK和USB To RS232部分电路图中找到USB供电电路

### ST-LINK ###

![](img/chapter0/ST-link_sch.png) 

### USB To RS232  ###

开发板有一个USB To RS232接口，用户的PC或笔记本通过USB线就可以跟开发板进行串口通信，当然了，首先你要安装USB转232驱动，安装详见USB2USRT章节，电路如下。

![](img/chapter0/usb_232_sch.png) 

###ADC & DHT11 ###

开发板板载一个DHT11温度传感器，可以用于采集环境温度或设备温度，板载有电位器可以实现AD模数转换实现,电路如下：

![](img/chapter0/adc_sch.png) 

### USBOTG  ###

STM32F407含有一个USB 2.0 OTG全速接口，接口速率12Mbps，它既可以作为OTG与其它OTG设备相连通过ID信号协商主从角色；也可以固定作为USB SLAVE从设备与PC等主设备相连实现USB读卡器，USB鼠标，USB固件升级等功能；还可以固定作为USB HOST连接U盘，USB键鼠等从设备。当作为USB从设备设备时通过D+、D-引脚上的1500Ω上拉电阻可向主机发出设备已连接的信号，并指示设备的工作速度。电阻上拉至D+表示全速运行，电阻上拉至D-表示低速运行。当作为USB主设备时内部D+和D-含有15kΩ下拉电阻用于检测上拉电阻的状态。

OTG就是On The Go，正在进行中的意思。USB OTG使USB装置摆脱了原来主从架构的限制，实现了端对端的传输模式。USB OTG标准在完全兼容USB2.0标准的基础上，增添了电源管理（节省功耗）功能，它允许设备既可作为主机，也可作为外设操作。

![](img/chapter0/usb_sch.png) 

### LCD & Touch ###

开发板载有3.2寸带触摸液晶显示屏，LCD 接口连接在 FSMC 总线上面。支持触摸，IIC_SDA,IIC_SCL用来实现对触摸屏的控制其原理图如下：

![](img/chapter0/lcd_sch.png) 
        
### 1062 ###

板载1062 wifi模块，该模块通过wifi 热点加入网络，通过socket编程进行网络数据通信。

![](img/chapter0/1062_sch.png) 
 
### SDcard ###

板载有标准的SD卡接口，采用STM32的高速SDIO接口访问SD卡，有了这个接口，我们就可以外扩大容量存储设备，可以用来记录数据。其原理图如下： 

![](img/chapter0/sd_sch.png) 

SD卡可通过SPI接口或者SDIO接口来通信，其中SDIO模式通信速率更高，在这里我们即是使用的SDIO模式进行通信。卡座的9脚SD用于卡插入检测。卡座内部有一个机械开关。当卡插入后，该机械开关闭合，和SD卡座的外壳（铁）搭接。一般外壳需要接GND，SD引脚接上拉电阻，这样即可实现无卡时SD口线为高电平，有卡时，SD口线为低电平。 

### Key & LED ###

开发板底板上总共有5个LED指示灯，其中1个是3.3V电源指示灯，还有两个下载调试指示灯。其它2个是用户LED指示灯。用户LED指示灯由GPIO管脚控制LED灯的亮灭，当GPIO管脚输出低电平时，LED指示灯亮。反之，当GPIO管脚输出高电平时，LED指示灯灭。这两个LED指示灯分别由PA8、PB8控制。

![](img/chapter0/led_sch.png) 

开发板总共有6个功能按键，分别是WAKEUP按键和RESET按键及四个用于自定义功能用户按键。四个用户按键分别与PD6、PE2、PE3和PE4四个GPIO管脚连接，当按键按下时，对应的GPIO管脚为低电平，反之，当没有按键按下时，对应的GPIO管脚为高电平。WKUP按键PA0 (STM32的WKUP引脚)可以作为WK_UP功能，它除了可以用作普通输入按键外，还可以用作STM32的唤醒输入。

![](img/chapter0/key_sch.png) 
        
        
### IIC ###

开发板自带了24C02的EEPROM芯片，该芯片的容量为2Kbit，也就是256个字节，对于我们普通应用来说是足够了的。你也可以选择换大的芯片，因为在原理上是兼容24C02~24C512全系列的EEPROM芯片的。其原理图如下： 

![](img/chapter0/eeprom_sch.png) 

### Connector ###

#### 血压计 ####

本开发板独有的血压计接口，通过与配套的血压计模块配套使用，进行血压计的案例开发

![](img/chapter0/blood_sch.png) 


#### Ethernet ####

STM32F407内部集成有高性能以太网模块，支持通过以太网收发数据，符合IEEE 802.3-2002标准。该以太网模块灵活可调，使之能适应各种不同的客户需求。该模块支持两种标准接口，连接到外接的物理层(PHY)模块：IEEE 802.3协议定义的独立于介质的接口(MII)和简化的独立于介质的接口(RMII)。适用于各类应用，如交换机、网络接口卡等。开发板将以太网的管脚引出，通过与配套的模块进行使用。

![](img/chapter0/ethernet_sch.png) 

#### Camera ####
开发板设置了 2x9 排座作为外置摄像头接口，该接口为 8bit 并行数据接口， 除了采集到的图像数据还有 VSYNC， HSYNC 以及像素时钟 PIXCLK  输出到 stm32f407。另外接口的 3,4 引脚是摄像头控制接口（SCCB） 。通过与之配套的摄像头模块连接使用 

![](img/chapter0/camera_sch.png) 

#### SPI ####
开发板载有SPI FLASH芯片W25X16，该芯片的容量为2M字节(16MBit)，和引出的标准2.54间距的spi 接口，其原理图如下：

![](img/chapter0/spi_sch.png) 

#### IIS ####
开发板预留了IIS的音频接口，通过与配套的音频模块连接使用

![](img/chapter0/iis_sch.png) 

#### UART ####
底板载引出了2个uart，uart1和uart3，其中uart1经过usb转串口芯片，用户之需要安装串口驱动，通过usb线与PC相连，便可以使用。同时uart1 和uart3 扩展出了标准2.54的排针，方便用户扩展使用 ,uart1和uart3的原理图如下图所示：

![](img/chapter0/485_sch.png) 

#### CAN ####
底板板载了 CAN 总线接口，支持 CAN 协议 2.0A 和 2.0B，板上兼容 5V电压的 CAN 物理层接口芯片和 3.3V 电压 CAN 物理层接口芯片来实现 CAN。

![](img/chapter0/can_sch.png) 

#### arduino ####
ELink407开发板引出了标准的arduino接口，可扩展使用arduino 的外设。

![](img/chapter0/arduino_sch.png) 

#### 扩展GPIO接口 ####
ELink407开发板将部分IO管脚使用标准双排插针引出，方便大家的实验和测试，调试其他模块或功能扩展

![](img/chapter0/other_sch.png) 


## 开发板使用注意事项 ##

### 基本注意事项 ###
为了让大家更好的学习使用ELink407，我们在这里使用的时候需要注意的一些问题。

1，  开发板一般情况是由 USB_DEBUG口(J16)供电，在使用电源适配器供电前，先检查适配器的输出是5V。PC的1 个 USB 供电最多 500mA，且由于导线电阻存在，供到开发板的电压，一般都不会有5V，如果使用了很多大负载外设，有可能引起 USB 供电不够，建用适配器供电。

2，  使用1062模块进行wifi通信时，请接上天线，如果没有天线，传输距离很短。

3，  当你想使用某个 IO 口用作其他用处的时候，请先看看开发板的原理图，该 IO 口是否有连接在开发板的某个外设上，如果有，该外设的这个信号是否会对你的使用造成干扰，先确定无干扰，再使用这个 IO。

4，  开发板上的跳线帽比较多，大家在使用某个功能的时候，要先查查这个是否需要设置跳线帽，以免浪费时间。具体可参见下面的跳线对照表

5，  开发板的 USB SLAVE 和 USB HOST 共用同一个 USB 口，所以，他们不可以同时使用。

### 跳线对照表 ###
ELink407的跳线排针均为2.54间距的排针,通过跳线帽短接即可。需要说明的是带三角符号丝印的脚为1脚，或者看背面的焊盘形状也可以，1脚的焊盘为正方形，其它脚为圆形。
 
![跳线对照表](img/chapter0/jumper.png)
 
